--FOR EXECUTE--
EXEC  BRONZE.LOAD_BRONZE
------------------------------

CREATE OR ALTER PROCEDURE BRONZE.LOAD_BRONZE AS
BEGIN 
  DECLARE @START_TIME DATETIME,@END_TIME DATETIME,@BATCH_START_TIME DATETIME,@BATCH_END_TIME DATETIME;
  BEGIN TRY
   SET @BATCH_START_TIME=GETDATE();
   PRINT '===============================================';
   PRINT 'LOADING BRONZE LAYER';
   PRINT '===============================================';

   PRINT '-----------------------------------------------';
   PRINT 'LOADING CRM TABLES';
   PRINT '-----------------------------------------------';


SET @START_TIME=GETDATE();
PRINT'>>TRUNCATING TABLE:BRONZE.CRM_CUST_INFO';
TRUNCATE TABLE BRONZE.CRM_CUST_INFO;

PRINT'>>INSERTING DATA INTO:BRONZE.CRM_CUST_INFO';
BULK INSERT BRONZE.CRM_CUST_INFO
FROM 'C:\Users\admin\Desktop\sql-data-warehouse-project\datasets\source_crm\CUST_INFO.CSV'
WITH(
  FIRSTROW=2,
  FIELDTERMINATOR=',',
  TABLOCK
);
SET @END_TIME=GETDATE();
PRINT'>>LOAD DURATION:' +CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'------------'



SET @START_TIME=GETDATE();
PRINT'>>TRUNCATING TABLE:BRONZE.CRM_PRD_INFO';
TRUNCATE TABLE BRONZE.CRM_PRD_INFO;

PRINT'>>INSERTING DATA INTO:BRONZE.CRM_PRD_INFO';
BULK INSERT BRONZE.CRM_PRD_INFO
FROM  'C:\Users\admin\Desktop\sql-data-warehouse-project\datasets\source_crm\PRD_INFO.CSV'
WITH(
  FIRSTROW=2,
  FIELDTERMINATOR=',',
  TABLOCK
);
SET @END_TIME=GETDATE();
PRINT'>>LOAD DURATION:' +CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'------------'

SET @START_TIME=GETDATE();
PRINT'>>TRUNCATING TABLE:BRONZE.CRM_SALES_DETAILS';
TRUNCATE TABLE BRONZE.CRM_SALES_DETAILS;

PRINT'>>INSERTING DATA INTO:BRONZE.CRM_SALES_DETAILS';
BULK INSERT BRONZE.CRM_SALES_DETAILS
FROM 'C:\Users\admin\Desktop\sql-data-warehouse-project\datasets\source_crm\SALES_DETAILS.CSV'
WITH(
  FIRSTROW=2,
  FIELDTERMINATOR=',',
  TABLOCK
);
SET @END_TIME=GETDATE();
PRINT'>>LOAD DURATION:' +CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'------------'


PRINT '-----------------------------------------------';
PRINT 'LOADING CRM TABLES';
PRINT '-----------------------------------------------';

SET @START_TIME=GETDATE();
PRINT'>>TRUNCATING TABLE:BRONZE.ERP_LOC_A101';
TRUNCATE TABLE BRONZE.ERP_LOC_A101;

PRINT'>>INSERTING DATA INTO:BRONZE.ERP_LOC_A101';
BULK INSERT BRONZE.ERP_LOC_A101
FROM 'C:\Users\admin\Desktop\sql-data-warehouse-project\datasets\source_erp\LOC_A101.CSV'
WITH(
  FIRSTROW=2,
  FIELDTERMINATOR=',',
  TABLOCK
);
SET @END_TIME=GETDATE();
PRINT'>>LOAD DURATION:' +CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'------------'

SET @START_TIME=GETDATE();
PRINT'>>TRUNCATING TABLE:BRONZE.BRONZE.ERP_LOC_CUST_AZ12';
TRUNCATE TABLE BRONZE.ERP_LOC_CUST_AZ12;

PRINT'>>INSERTING DATA INTO:BRONZE.ERP_LOC__CUST_AZ12';
BULK INSERT BRONZE.ERP_LOC_CUST_AZ12
FROM 'C:\Users\admin\Desktop\sql-data-warehouse-project\datasets\source_erp\CUST_AZ12.CSV'
WITH(
  FIRSTROW=2,
  FIELDTERMINATOR=',',
  TABLOCK
);
SET @END_TIME=GETDATE();
PRINT'>>LOAD DURATION:' +CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'------------'


SET @START_TIME=GETDATE();
PRINT'>>TRUNCATING TABLE:BRONZE.BRONZE.ERP_PX_CAT_G1V2';
TRUNCATE TABLE BRONZE.ERP_PX_CAT_G1V2;

PRINT'>>INSERTING DATA INTO:BRONZE.ERP_PX_CAT_G1V2';
BULK INSERT BRONZE.ERP_PX_CAT_G1V2
FROM 'C:\Users\admin\Desktop\sql-data-warehouse-project\datasets\source_erp\PX_CAT_G1V2.CSV'
WITH(
  FIRSTROW=2,
  FIELDTERMINATOR=',',
  TABLOCK
);
SET @END_TIME=GETDATE();
PRINT'>>LOAD DURATION:' +CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'------------';

SET @BATCH_END_TIME=GETDATE();
PRINT'==========================================================='
PRINT'LOADING BRONZE LAYER IS COMPLETED';
PRINT'  -TOTAL LOAD DURATION: '+CAST(DATEDIFF(SECOND,@BATCH_START_TIME,@BATCH_END_TIME) AS NVARCHAR)+' SECONDS';
PRINT'==========================================================='
END TRY
BEGIN CATCH
  PRINT'=========================================='
  PRINT'ERROR OCCURED DURING LOADING BRONZE LAYER'
  PRINT'ERROR MESSAGE'+ERROR_MESSAGE();
  PRINT'ERROR MESSAGE'+CAST(ERROR_NUMBER() AS NVARCHAR);
  PRINT'ERROR MESSAGE'+CAST(ERROR_STATE() AS NVARCHAR);
  PRINT'==========================================='
END CATCH
END
